<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹­ì°¬ ë‚˜ë¬´ (ê°œì¸ë³„ ê´€ë¦¬)</title>
    <style>
        body {
            font-family: "Comic Sans MS", cursive;
            background: #fffde7;
            text-align: center;
            padding: 20px;
        }
        
        h1 {
            color: #f57f17;
        }
        
        .tree {
            position: relative;
            width: 600px;
            height: 800px;
            margin: 0px auto;
            background-image: url('trees.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
        }
        
        .canopy {
            position: absolute;
            top: 300px;
            left: 100px;
            width: 400px;
            height: 200px;
            border-radius: 50%;
            overflow: visible;
        }
        
        .leaf {
            position: absolute;
            font-size: 28px;
            animation: leafGrow 0.5s ease-in-out;
            cursor: pointer;
        }
        
        /* ë‚´ê°€ ì“´ ìì‚¬ê·€ ìŠ¤íƒ€ì¼ */
        .leaf.my-leaf {
            filter: drop-shadow(0 0 3px #4caf50);
        }
        
        @keyframes leafGrow {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .leaf:hover {
            transform: scale(1.2);
            transition: transform 0.2s;
        }
        
        input {
            padding: 8px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        .button {
            background-color: #fbc02d;
            color: #333;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
        }
        
        .button:hover {
            background-color: #f9a825;
            transform: translateY(-2px);
            transition: all 0.2s;
        }
        
        .reset-button {
            background-color: #ff7043;
        }
        
        .reset-button:hover {
            background-color: #ff5722;
        }
        
        /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
        }
        
        .button:disabled:hover {
            background-color: #cccccc;
            transform: none;
        }
        
        .card {
            background: #fff9c4;
            border: 2px solid #fdd835;
            border-radius: 10px;
            margin: 10px auto;
            padding: 15px;
            width: 350px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: cardSlideIn 0.3s ease-out;
            position: relative;
        }
        
        /* ë‚´ê°€ ì“´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card.my-card {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .card.my-card::before {
            content: "âœï¸";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        @keyframes cardSlideIn {
            0% {
                transform: translateY(-20px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            display: inline-block;
        }
        
        .user-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            width: 300px;
            display: inline-block;
        }
        
        /* ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ ì•ˆë‚´ ë©”ì‹œì§€ */
        .reset-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        @media (max-width: 500px) {
            .tree {
                width: 300px;
                height: 450px;
            }
            
            .canopy {
                top: 40px;
                left: 40px;
                width: 220px;
                height: 220px;
            }
            
            .card {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸŒŸ ìš°ë¦¬ ë°˜ ì¹­ì°¬ ë‚˜ë¬´ ğŸŒŸ</h1>
    <p>ì¹œêµ¬ì—ê²Œ ì¹­ì°¬ì„ í•˜ë©´ ë‚˜ë¬´ì— ìì‚¬ê·€(ğŸƒ)ê°€ ìƒê²¨ìš”!</p>
    
    <div class="user-info">
        <label for="writerName">âœï¸ ë‚´ ì´ë¦„: </label>
        <input type="text" id="writerName" placeholder="ë‚´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onchange="updateUserInfo()">
        <span id="currentUser"></span>
    </div>
    
    <div class="controls">
        <input type="text" id="friendName" placeholder="ì¹œêµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        <input type="text" id="compliment" placeholder="ë”°ëœ»í•œ ì¹­ì°¬ì„ ì ì–´ì£¼ì„¸ìš”">
        <br>
        <button class="button" onclick="growTree()">ğŸŒ± ì¹­ì°¬í•˜ê¸°</button>
        <button class="button reset-button" onclick="resetMyContributions()">ğŸ”„ ë‚´ê°€ ì“´ ê¸€ë§Œ ì‚­ì œ</button>
        <button class="button reset-button" id="resetAllButton" onclick="resetAllTree()" style="background-color: #d32f2f;" disabled>ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        <div class="reset-info" id="resetInfo">
            ìì‚¬ê·€ 50ê°œ ì´ìƒì¼ ë•Œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”
        </div>
    </div>

    <div class="stats" id="stats">
        <div>ğŸŒ³ ì „ì²´ ìì‚¬ê·€: <span id="totalLeaves">0</span>ê°œ</div>
        <div>âœï¸ ë‚´ê°€ ì“´ ìì‚¬ê·€: <span id="myLeaves">0</span>ê°œ</div>
    </div>

    <div class="tree">
        <div class="canopy" id="canopy"></div>
    </div>

    <div id="cardArea"></div>

    <script>
        let currentWriter = '';
        let allPosts = JSON.parse(localStorage.getItem('praisePosts')) || [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë³µì›
        window.onload = function() {
            loadSavedData();
            updateStats();
            updateResetButton();
        };

        function updateUserInfo() {
            const writerInput = document.getElementById('writerName');
            currentWriter = writerInput.value.trim();
            const currentUserSpan = document.getElementById('currentUser');
            
            if (currentWriter) {
                currentUserSpan.textContent = `(í˜„ì¬: ${currentWriter})`;
                currentUserSpan.style.color = '#4caf50';
                currentUserSpan.style.fontWeight = 'bold';
            } else {
                currentUserSpan.textContent = '';
            }
            updateStats();
        }

        function updateResetButton() {
            const resetButton = document.getElementById('resetAllButton');
            const resetInfo = document.getElementById('resetInfo');
            const totalLeaves = allPosts.length;
            
            if (totalLeaves >= 50) {
                resetButton.disabled = false;
                resetButton.style.backgroundColor = '#d32f2f';
                resetInfo.textContent = `ìì‚¬ê·€ê°€ ${totalLeaves}ê°œ! ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”`;
                resetInfo.style.color = '#d32f2f';
            } else {
                resetButton.disabled = true;
                resetButton.style.backgroundColor = '#cccccc';
                resetInfo.textContent = `ìì‚¬ê·€ ${50 - totalLeaves}ê°œ ë” í•„ìš”í•´ìš” (í˜„ì¬ ${totalLeaves}/50)`;
                resetInfo.style.color = '#666';
            }
        }

        function growTree() {
            const friendName = document.getElementById("friendName").value.trim();
            const compliment = document.getElementById("compliment").value.trim();
            
            if (!currentWriter) {
                alert("ë¨¼ì € ë‚´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! âœï¸");
                document.getElementById('writerName').focus();
                return;
            }

            if (friendName && compliment) {
                const postId = Date.now() + Math.random(); // ê³ ìœ  ID ìƒì„±
                const newPost = {
                    id: postId,
                    writer: currentWriter,
                    friendName: friendName,
                    compliment: compliment,
                    timestamp: new Date().toISOString()
                };

                // ë°ì´í„° ì €ì¥
                allPosts.push(newPost);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // ìì‚¬ê·€ ìƒì„±
                createLeaf(newPost);
                
                // ì¹´ë“œ ìƒì„±
                createCard(newPost);

                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                document.getElementById("friendName").value = "";
                document.getElementById("compliment").value = "";

                // í†µê³„ ë° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateStats();
                updateResetButton();

                // ì„±ì·¨ê° ë©”ì‹œì§€
                const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
                const totalPosts = allPosts.length;
                
                if (myPostsCount === 1) {
                    showMessage("ğŸ‰ ì²« ë²ˆì§¸ ì¹­ì°¬ì„ ë‚¨ê²¼ì–´ìš”!");
                } else if (myPostsCount % 5 === 0) {
                    showMessage(`ğŸŒŸ ${myPostsCount}ë²ˆì§¸ ì¹­ì°¬ì´ì—ìš”! ë©‹ì ¸ìš”!`);
                }
                
                // 50ê°œ ë‹¬ì„± ì‹œ íŠ¹ë³„ ë©”ì‹œì§€
                if (totalPosts === 50) {
                    showMessage("ğŸŠ ì¶•í•˜í•´ìš”! ìì‚¬ê·€ 50ê°œ ë‹¬ì„±! ì´ì œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”!");
                }

            } else {
                alert("ì¹œêµ¬ ì´ë¦„ê³¼ ì¹­ì°¬ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”! ğŸ’");
            }
        }

        function createLeaf(post) {
            const canopy = document.getElementById("canopy");
            const leaf = document.createElement("div");
            leaf.classList.add("leaf");
            leaf.innerHTML = "ğŸƒ";
            leaf.title = `${post.writer} â†’ ${post.friendName}: ${post.compliment}`;
            leaf.dataset.postId = post.id;
            
            // ë‚´ê°€ ì“´ ê¸€ì¸ì§€ í™•ì¸
            if (post.writer === currentWriter) {
                leaf.classList.add("my-leaf");
            }

            // ëœë¤ ìœ„ì¹˜ ë°°ì¹˜
            const maxX = canopy.clientWidth - 40;
            const maxY = canopy.clientHeight - 40;
            leaf.style.left = Math.random() * maxX + "px";
            leaf.style.top = Math.random() * maxY + "px";

            canopy.appendChild(leaf);
        }

        function createCard(post) {
            const card = document.createElement("div");
            card.classList.add("card");
            card.dataset.postId = post.id;
            
            // ë‚´ê°€ ì“´ ê¸€ì¸ì§€ í™•ì¸
            if (post.writer === currentWriter) {
                card.classList.add("my-card");
            }

            card.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center;">
                    <span style="font-size: 24px; margin-right: 10px;">ğŸ’Œ</span>
                    <div>
                        <strong style="color: #f57f17; font-size: 18px;">${post.friendName}</strong>ì—ê²Œ<br>
                        <em style="color: #555;">"${post.compliment}"</em><br>
                        <small style="color: #888; margin-top: 5px; display: block;">
                            - ${post.writer} (${new Date(post.timestamp).toLocaleDateString()})
                        </small>
                    </div>
                </div>
            `;

            const cardArea = document.getElementById("cardArea");
            cardArea.insertBefore(card, cardArea.firstChild);
        }

        function resetMyContributions() {
            if (!currentWriter) {
                alert("ë¨¼ì € ë‚´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! âœï¸");
                return;
            }

            const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
            
            if (myPostsCount === 0) {
                alert("ì‚­ì œí•  ë‚´ ê¸€ì´ ì—†ì–´ìš”! ğŸ¤”");
                return;
            }

            if (confirm(`ì •ë§ë¡œ ë‚´ê°€ ì“´ ${myPostsCount}ê°œì˜ ì¹­ì°¬ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”? ğŸ˜¢`)) {
                // ë‚´ê°€ ì“´ ê¸€ë“¤ì˜ ID ìˆ˜ì§‘
                const myPostIds = allPosts.filter(post => post.writer === currentWriter).map(post => post.id);
                
                // ë°ì´í„°ì—ì„œ ë‚´ ê¸€ë“¤ ì œê±°
                allPosts = allPosts.filter(post => post.writer !== currentWriter);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // í™”ë©´ì—ì„œ ë‚´ ìì‚¬ê·€ë“¤ ì œê±°
                myPostIds.forEach(postId => {
                    const leaf = document.querySelector(`.leaf[data-post-id="${postId}"]`);
                    const card = document.querySelector(`.card[data-post-id="${postId}"]`);
                    
                    if (leaf) leaf.remove();
                    if (card) card.remove();
                });

                updateStats();
                updateResetButton();
                showMessage(`âœ… ë‚´ê°€ ì“´ ${myPostsCount}ê°œì˜ ê¸€ì„ ì‚­ì œí–ˆì–´ìš”!`);
            }
        }

        function resetAllTree() {
            const totalPosts = allPosts.length;
            
            // 50ê°œ ë¯¸ë§Œì´ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•˜ì§€ë§Œ ì•ˆì „ì¥ì¹˜)
            if (totalPosts < 50) {
                alert("ìì‚¬ê·€ê°€ 50ê°œ ì´ìƒì¼ ë•Œë§Œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”! ğŸŒ³");
                return;
            }

            if (confirm(`âš ï¸ ì£¼ì˜: ëª¨ë“  ì‚¬ëŒì˜ ì¹­ì°¬ ${totalPosts}ê°œê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤!\nì •ë§ë¡œ ì „ì²´ ì´ˆê¸°í™”ë¥¼ í•˜ì‹œê² ì–´ìš”?`)) {
                allPosts = [];
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));
                
                document.getElementById("canopy").innerHTML = "";
                document.getElementById("cardArea").innerHTML = "";
                
                updateStats();
                updateResetButton();
                showMessage("ğŸŒ± ì¹­ì°¬ ë‚˜ë¬´ê°€ ì™„ì „íˆ ìƒˆë¡œ ì‹œì‘ë˜ì—ˆì–´ìš”!");
            }
        }

        function loadSavedData() {
            // ì €ì¥ëœ ë°ì´í„°ë¡œ ìì‚¬ê·€ì™€ ì¹´ë“œ ë³µì›
            allPosts.forEach(post => {
                createLeaf(post);
                createCard(post);
            });
        }

        function updateStats() {
            const totalLeaves = allPosts.length;
            const myLeaves = currentWriter ? allPosts.filter(post => post.writer === currentWriter).length : 0;
            
            document.getElementById('totalLeaves').textContent = totalLeaves;
            document.getElementById('myLeaves').textContent = myLeaves;
        }

        function showMessage(text) {
            const message = document.createElement("div");
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #4caf50;
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                z-index: 1000;
                animation: messageShow 2s ease-in-out forwards;
            `;
            message.textContent = text;
            document.body.appendChild(message);

            setTimeout(() => {
                document.body.removeChild(message);
            }, 2000);
        }

        // ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜
        const style = document.createElement('style');
        style.textContent = `
            @keyframes messageShow {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            }
        `;
        document.head.appendChild(style);

        // ì—”í„°í‚¤ ì§€ì›
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.activeElement.id !== 'writerName') {
                growTree();
            }
        });
    </script>
</body>
</html>
