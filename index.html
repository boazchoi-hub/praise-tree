<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Ïπ≠Ï∞¨ ÎÇòÎ¨¥ (Í∞úÏù∏Î≥Ñ Í¥ÄÎ¶¨)</title>
    <style>
        body {
            font-family: "Noto Sans KR", "ÎßëÏùÄ Í≥†Îîï", sans-serif;
            background: #fffde7;
            padding: 20px;
            margin: 0;
        }
        
        h1 {
            color: #f57f17;
            text-align: center;
        }
        
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .left-section {
            flex: 1;
            min-width: 500px;
            text-align: center;
        }
        
        .right-section {
            flex: 1;
            min-width: 400px;
            max-width: 500px;
        }
        
        /* ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÌëúÏãú ÏòÅÏó≠ */
        .selected-card-display {
            background: linear-gradient(135deg, #fff3e0, #f3e5f5);
            border: 3px solid #ff9800;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            width: 400px;
            min-height: 120px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: selectedCardShow 0.3s ease-out;
            position: relative;
            display: none;
        }
        
        .selected-card-display.show {
            display: block;
        }
        
        .selected-card-display::before {
            content: "üåü ÏÑ†ÌÉùÎêú Ïπ≠Ï∞¨ üåü";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff9800;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .selected-card-content {
            text-align: center;
        }
        
        .selected-card-content .target-name-large {
            color: #e65100;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .selected-card-content .compliment-large {
            color: #424242;
            font-size: 18px;
            font-style: italic;
            margin: 15px 0;
            line-height: 1.4;
        }
        
        .selected-card-content .writer-large {
            color: #1976d2;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .close-selected {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-selected:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }
        
        @keyframes selectedCardShow {
            0% {
                transform: translateY(-30px) scale(0.9);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .tree {
            position: relative;
            width: 500px;
            height: 700px;
            margin: 20px auto;
            background-image: url('trees.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
        }
        
        .canopy {
            position: absolute;
            top: 250px;
            left: 80px;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            overflow: visible;
        }
        
        .leaf {
            position: absolute;
            font-size: 28px;
            animation: leafGrow 0.5s ease-in-out;
            cursor: pointer;
        }
        
        /* ÎÇ¥Í∞Ä Ïì¥ ÏûéÏÇ¨Í∑Ä Ïä§ÌÉÄÏùº */
        .leaf.my-leaf {
            filter: drop-shadow(0 0 3px #4caf50);
        }
        
        @keyframes leafGrow {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .leaf:hover {
            transform: scale(1.2);
            transition: transform 0.2s;
        }
        
        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        .button {
            background-color: #fbc02d;
            color: #333;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
        }
        
        .button:hover {
            background-color: #f9a825;
            transform: translateY(-2px);
            transition: all 0.2s;
        }
        
        .reset-button {
            background-color: #ff7043;
        }
        
        .reset-button:hover {
            background-color: #ff5722;
        }
        
        /* ÎπÑÌôúÏÑ±ÌôîÎêú Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
        }
        
        .button:disabled:hover {
            background-color: #cccccc;
            transform: none;
        }
        
        .card {
            background: #fff9c4;
            border: 2px solid #fdd835;
            border-radius: 10px;
            margin: 10px 0;
            padding: 15px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: cardSlideIn 0.3s ease-out;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* ÏÑ†ÌÉùÎêú Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .card.selected {
            border-color: #ff9800;
            background: #fff3e0;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .card.selected::after {
            content: "üëÜ";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff9800;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ÎÇ¥Í∞Ä Ïì¥ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .card.my-card {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .card.my-card.selected {
            border-color: #ff9800;
            background: #fff3e0;
        }
        
        .card.my-card::before {
            content: "‚úçÔ∏è";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 1;
        }
        
        .card.my-card.selected::before {
            display: none;
        }
        
        /* Ïà®Í≤®ÏßÑ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .card.hidden {
            display: none;
        }
        
        @keyframes cardSlideIn {
            0% {
                transform: translateY(-20px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            display: inline-block;
        }
        
        .user-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            width: 300px;
            display: inline-block;
        }
        
        /* Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî Î≤ÑÌäº ÏïàÎÇ¥ Î©îÏãúÏßÄ */
        .reset-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Ïò§Î•∏Ï™Ω ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .cards-header {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .filter-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .filter-section h3 {
            margin: 0 0 10px 0;
            color: #f57f17;
        }
        
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .filter-btn {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: #2196f3;
            color: white;
        }
        
        .cards-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .cards-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .cards-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .cards-container::-webkit-scrollbar-thumb {
            background: #fbc02d;
            border-radius: 10px;
        }
        
        .cards-container::-webkit-scrollbar-thumb:hover {
            background: #f9a825;
        }
        
        .search-section {
            margin-bottom: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .clear-filter {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .clear-filter:hover {
            background: #f57c00;
        }
        
        .filter-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .writer-name, .target-name {
            color: #1976d2;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .writer-name:hover, .target-name:hover {
            color: #0d47a1;
            font-weight: bold;
        }
        
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .selected-card-display {
                width: 90%;
                max-width: 400px;
            }
            
            .tree {
                width: 300px;
                height: 450px;
            }
            
            .canopy {
                top: 40px;
                left: 40px;
                width: 220px;
                height: 220px;
            }
            
            .left-section, .right-section {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <h1>üåü Ïö∞Î¶¨ Î∞ò Ïπ≠Ï∞¨ ÎÇòÎ¨¥ üåü</h1>
    <p style="text-align: center;">ÏπúÍµ¨ÏóêÍ≤å Ïπ≠Ï∞¨ÏùÑ ÌïòÎ©¥ ÎÇòÎ¨¥Ïóê ÏûéÏÇ¨Í∑Ä(üçÉ)Í∞Ä ÏÉùÍ≤®Ïöî!</p>
    
    <div class="main-container">
        <!-- ÏôºÏ™Ω ÏÑπÏÖò: ÎÇòÎ¨¥ÏôÄ Ïª®Ìä∏Î°§ -->
        <div class="left-section">
            <div class="user-info">
                <label for="writerName">‚úèÔ∏è ÎÇ¥ Ïù¥Î¶Ñ: </label>
                <input type="text" id="writerName" placeholder="ÎÇ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onchange="updateUserInfo()">
                <span id="currentUser"></span>
            </div>
            
            <!-- ÏÑ†ÌÉùÎêú Ïπ≠Ï∞¨ Ïπ¥Îìú ÌëúÏãú ÏòÅÏó≠ -->
            <div class="selected-card-display" id="selectedCardDisplay">
                <button class="close-selected" onclick="closeSelectedCard()">√ó</button>
                <div class="selected-card-content" id="selectedCardContent">
                    <!-- ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
            
            <div class="controls">
                <input type="text" id="friendName" placeholder="ÏπúÍµ¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                <input type="text" id="compliment" placeholder="Îî∞ÎúªÌïú Ïπ≠Ï∞¨ÏùÑ Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî">
                <br>
                <button class="button" onclick="growTree()">üå± Ïπ≠Ï∞¨ÌïòÍ∏∞</button>
                <button class="button reset-button" onclick="resetMyContributions()">üîÑ ÎÇ¥Í∞Ä Ïì¥ Í∏ÄÎßå ÏÇ≠Ï†ú</button>
                <button class="button reset-button" id="resetAllButton" onclick="resetAllTree()" style="background-color: #d32f2f;" disabled>üóëÔ∏è Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
                <div class="reset-info" id="resetInfo">
                    ÏûéÏÇ¨Í∑Ä 50Í∞ú Ïù¥ÏÉÅÏùº Îïå Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÍ∞Ä Í∞ÄÎä•Ìï¥Ïöî
                </div>
            </div>

            <div class="stats" id="stats">
                <div>üå≥ Ï†ÑÏ≤¥ ÏûéÏÇ¨Í∑Ä: <span id="totalLeaves">0</span>Í∞ú</div>
                <div>‚úçÔ∏è ÎÇ¥Í∞Ä Ïì¥ ÏûéÏÇ¨Í∑Ä: <span id="myLeaves">0</span>Í∞ú</div>
            </div>

            <div class="tree">
                <div class="canopy" id="canopy"></div>
            </div>
        </div>
        
        <!-- Ïò§Î•∏Ï™Ω ÏÑπÏÖò: Ïπ≠Ï∞¨ Ïπ¥ÎìúÎì§ -->
        <div class="right-section">
            <div class="cards-header">
                <h2>üíå Ïπ≠Ï∞¨ Ïπ¥ÎìúÎì§</h2>
                <p>Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÎÇòÎ¨¥ ÏúÑÏóê ÌÅ¨Í≤å ÌëúÏãúÎèºÏöî!</p>
            </div>
            
            <div class="filter-section">
                <h3>üîç ÌïÑÌÑ∞ÎßÅ</h3>
                
                <div class="search-section">
                    <input type="text" class="search-input" id="searchInput" placeholder="ÏûëÏÑ±ÏûêÎÇò ÎåÄÏÉÅÏûê Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ..." oninput="filterCards()">
                </div>
                
                <div>
                    <strong>üë• ÏûëÏÑ±ÏûêÎ≥Ñ:</strong>
                    <div class="filter-buttons" id="writerFilters"></div>
                </div>
                
                <div style="margin-top: 15px;">
                    <strong>üéØ ÎåÄÏÉÅÏûêÎ≥Ñ:</strong>
                    <div class="filter-buttons" id="targetFilters"></div>
                </div>
                
                <button class="clear-filter" onclick="clearAllFilters()">üîÑ Ï†ÑÏ≤¥ Î≥¥Í∏∞</button>
                
                <div class="filter-info" id="filterInfo">
                    Ï†ÑÏ≤¥ Ïπ≠Ï∞¨ Ïπ¥ÎìúÎ•º Î≥¥Í≥† ÏûàÏñ¥Ïöî
                </div>
            </div>
            
            <div class="cards-container" id="cardArea"></div>
        </div>
    </div>

    <script>
        let currentWriter = '';
        let allPosts = JSON.parse(localStorage.getItem('praisePosts')) || [];
        let currentFilter = { type: 'all', value: '' };
        let selectedCardId = null;

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
        window.onload = function() {
            loadSavedData();
            updateStats();
            updateResetButton();
            updateFilterButtons();
        };

        function updateUserInfo() {
            const writerInput = document.getElementById('writerName');
            currentWriter = writerInput.value.trim();
            const currentUserSpan = document.getElementById('currentUser');
            
            if (currentWriter) {
                currentUserSpan.textContent = `(ÌòÑÏû¨: ${currentWriter})`;
                currentUserSpan.style.color = '#4caf50';
                currentUserSpan.style.fontWeight = 'bold';
            } else {
                currentUserSpan.textContent = '';
            }
            updateStats();
        }

function selectCard(postId) {
    // Ïù¥Ï†ÑÏóê ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏÑ†ÌÉù Ìï¥Ï†ú
    const previousSelected = document.querySelector('.card.selected');
    if (previousSelected) {
        previousSelected.classList.remove('selected');
    }
    
    // ÏÉàÎ°úÏö¥ Ïπ¥Îìú ÏÑ†ÌÉù (ID ÎπÑÍµê Ïãú ÌÉÄÏûÖ Î≥ÄÌôò Í≥†Î†§)
    const selectedCard = document.querySelector(`.card[data-post-id="${postId}"]`);
    if (selectedCard) {
        selectedCard.classList.add('selected');
        selectedCardId = postId;
        
        // ÏÑ†ÌÉùÎêú Ïπ¥Îìú Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ (ID ÎπÑÍµê Ïãú ÌÉÄÏûÖ Î≥ÄÌôò Í≥†Î†§)
        const post = allPosts.find(p => p.id == postId);
        if (post) {
            showSelectedCard(post);
        }
    }
}

function showSelectedCard(post) {
    const display = document.getElementById('selectedCardDisplay');
    const content = document.getElementById('selectedCardContent');
    
    content.innerHTML = `
        <div class="target-name-large">${post.friendName}ÎãòÏóêÍ≤å</div>
        <div class="compliment-large">"${post.compliment}"</div>
        <div class="writer-large">
            üíù ${post.writer}ÎãòÏùò Ïπ≠Ï∞¨ 
            <small style="color: #666; font-weight: normal; margin-left: 10px;">
                (${new Date(post.timestamp).toLocaleDateString()})
            </small>
        </div>
    `;
    
    display.classList.add('show');
    
    // Ïä§ÌÅ¨Î°§ÏùÑ ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÌëúÏãú ÏòÅÏó≠ÏúºÎ°ú Î∂ÄÎìúÎüΩÍ≤å Ïù¥Îèô
    display.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
    });
}

function closeSelectedCard() {
    const display = document.getElementById('selectedCardDisplay');
    display.classList.remove('show');
    
    // ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏÑ†ÌÉù Ìï¥Ï†ú
    const selectedCard = document.querySelector('.card.selected');
    if (selectedCard) {
        selectedCard.classList.remove('selected');
    }
    
    selectedCardId = null;
}






        function updateResetButton() {
            const resetButton = document.getElementById('resetAllButton');
            const resetInfo = document.getElementById('resetInfo');
            const totalLeaves = allPosts.length;
            
            if (totalLeaves >= 50) {
                resetButton.disabled = false;
                resetButton.style.backgroundColor = '#d32f2f';
                resetInfo.textContent = `ÏûéÏÇ¨Í∑ÄÍ∞Ä ${totalLeaves}Í∞ú! Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÍ∞Ä Í∞ÄÎä•Ìï¥Ïöî`;
                resetInfo.style.color = '#d32f2f';
            } else {
                resetButton.disabled = true;
                resetButton.style.backgroundColor = '#cccccc';
                resetInfo.textContent = `ÏûéÏÇ¨Í∑Ä ${50 - totalLeaves}Í∞ú Îçî ÌïÑÏöîÌï¥Ïöî (ÌòÑÏû¨ ${totalLeaves}/50)`;
                resetInfo.style.color = '#666';
            }
        }

        function updateResetButton() {
    const resetButton = document.getElementById('resetAllButton');
    const resetInfo = document.getElementById('resetInfo');
    const totalLeaves = allPosts.length;
    
    // Ïù¥Î¶ÑÏù¥ 'ÏµúÎ≥ëÏö∞'Ïù∏ÏßÄ ÌôïÏù∏
    const isAuthorized = currentWriter === 'ÏµúÎ≥ëÏö∞';
    
    if (isAuthorized) {
        resetButton.disabled = false;
        resetButton.style.backgroundColor = '#d32f2f';
        resetInfo.textContent = `Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏúºÎ°ú Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÍ∞Ä Í∞ÄÎä•Ìï¥Ïöî (ÌòÑÏû¨ ${totalLeaves}Í∞ú)`;
        resetInfo.style.color = '#d32f2f';
    } else if (currentWriter) {
        resetButton.disabled = true;
        resetButton.style.backgroundColor = '#cccccc';
        resetInfo.textContent = `Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎäî Í¥ÄÎ¶¨ÏûêÎßå Í∞ÄÎä•Ìï¥Ïöî`;
        resetInfo.style.color = '#666';
    } else {
        resetButton.disabled = true;
        resetButton.style.backgroundColor = '#cccccc';
        resetInfo.textContent = `Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎäî Í¥ÄÎ¶¨ÏûêÎßå Í∞ÄÎä•Ìï¥Ïöî`;
        resetInfo.style.color = '#666';
    }
}


        function showSelectedCard(post) {
            const display = document.getElementById('selectedCardDisplay');
            const content = document.getElementById('selectedCardContent');
            
            content.innerHTML = `
                <div class="target-name-large">${post.friendName}ÎãòÏóêÍ≤å</div>
                <div class="compliment-large">"${post.compliment}"</div>
                <div class="writer-large">
                    üíù ${post.writer}ÎãòÏùò Ïπ≠Ï∞¨ 
                    <small style="color: #666; font-weight: normal; margin-left: 10px;">
                        (${new Date(post.timestamp).toLocaleDateString()})
                    </small>
                </div>
            `;
            
            display.classList.add('show');
            
            // Ïä§ÌÅ¨Î°§ÏùÑ ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÌëúÏãú ÏòÅÏó≠ÏúºÎ°ú Î∂ÄÎìúÎüΩÍ≤å Ïù¥Îèô
            display.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }

        function closeSelectedCard() {
            const display = document.getElementById('selectedCardDisplay');
            display.classList.remove('show');
            
            // ÏÑ†ÌÉùÎêú Ïπ¥Îìú ÏÑ†ÌÉù Ìï¥Ï†ú
            const selectedCard = document.querySelector('.card.selected');
            if (selectedCard) {
                selectedCard.classList.remove('selected');
            }
            
            selectedCardId = null;
        }

        function growTree() {
            const friendName = document.getElementById("friendName").value.trim();
            const compliment = document.getElementById("compliment").value.trim();
            
            if (!currentWriter) {
                alert("Î®ºÏ†Ä ÎÇ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî! ‚úèÔ∏è");
                document.getElementById('writerName').focus();
                return;
            }

            if (friendName && compliment) {
                const postId = Date.now() + Math.random(); // Í≥†Ïú† ID ÏÉùÏÑ±
                const newPost = {
                    id: postId,
                    writer: currentWriter,
                    friendName: friendName,
                    compliment: compliment,
                    timestamp: new Date().toISOString()
                };

                // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                allPosts.push(newPost);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // ÏûéÏÇ¨Í∑Ä ÏÉùÏÑ±
                createLeaf(newPost);
                
                // Ïπ¥Îìú ÏÉùÏÑ±
                createCard(newPost);

                // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
                document.getElementById("friendName").value = "";
                document.getElementById("compliment").value = "";

                // ÌÜµÍ≥Ñ Î∞è Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                updateStats();
                updateResetButton();
                updateFilterButtons();

                // ÏÑ±Ï∑®Í∞ê Î©îÏãúÏßÄ
                const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
                const totalPosts = allPosts.length;
                
                if (myPostsCount === 1) {
                    showMessage("üéâ Ï≤´ Î≤àÏß∏ Ïπ≠Ï∞¨ÏùÑ ÎÇ®Í≤ºÏñ¥Ïöî!");
                } else if (myPostsCount % 5 === 0) {
                    showMessage(`üåü ${myPostsCount}Î≤àÏß∏ Ïπ≠Ï∞¨Ïù¥ÏóêÏöî! Î©ãÏ†∏Ïöî!`);
                }
                
                // 50Í∞ú Îã¨ÏÑ± Ïãú ÌäπÎ≥Ñ Î©îÏãúÏßÄ
                if (totalPosts === 50) {
                    showMessage("üéä Ï∂ïÌïòÌï¥Ïöî! ÏûéÏÇ¨Í∑Ä 50Í∞ú Îã¨ÏÑ±! Ïù¥Ï†ú Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÍ∞Ä Í∞ÄÎä•Ìï¥Ïöî!");
                }

            } else {
                alert("ÏπúÍµ¨ Ïù¥Î¶ÑÍ≥º Ïπ≠Ï∞¨ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî! üíù");
            }
        }

        function createLeaf(post) {
            const canopy = document.getElementById("canopy");
            const leaf = document.createElement("div");
            leaf.classList.add("leaf");
            leaf.innerHTML = "üçÉ";
            leaf.title = `${post.writer} ‚Üí ${post.friendName}: ${post.compliment}`;
            leaf.dataset.postId = post.id;
            
            // ÎÇ¥Í∞Ä Ïì¥ Í∏ÄÏù∏ÏßÄ ÌôïÏù∏
            if (post.writer === currentWriter) {
                leaf.classList.add("my-leaf");
            }

            // ÎûúÎç§ ÏúÑÏπò Î∞∞Ïπò
            const maxX = canopy.clientWidth - 40;
            const maxY = canopy.clientHeight - 40;
            leaf.style.left = Math.random() * maxX + "px";
            leaf.style.top = Math.random() * maxY + "px";

            canopy.appendChild(leaf);
        }

       function createCard(post) {
    const card = document.createElement("div");
    card.classList.add("card");
    card.dataset.postId = post.id;
    card.dataset.writer = post.writer;
    card.dataset.target = post.friendName;
    
    // ÎÇ¥Í∞Ä Ïì¥ Í∏ÄÏù∏ÏßÄ ÌôïÏù∏
    if (post.writer === currentWriter) {
        card.classList.add("my-card");
    }

    // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
    card.onclick = (event) => {
        // Ïù¥Î≤§Ìä∏Í∞Ä ÏûëÏÑ±ÏûêÎÇò ÎåÄÏÉÅÏûê Ïù¥Î¶ÑÏóêÏÑú Î∞úÏÉùÌïú Í≤ΩÏö∞ Ïπ¥Îìú ÏÑ†ÌÉùÏùÑ ÎßâÏùå
        if (event.target.classList.contains('writer-name') || event.target.classList.contains('target-name')) {
            return;
        }
        selectCard(post.id);
    };

    card.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 24px; margin-right: 10px;">üíå</span>
            <div>
                <strong style="color: #f57f17; font-size: 18px;" class="target-name" onclick="event.stopPropagation(); filterByTarget('${post.friendName}')">${post.friendName}</strong>ÏóêÍ≤å<br>
                <em style="color: #555;">"${post.compliment}"</em><br>
                <small style="color: #888; margin-top: 5px; display: block;">
                    - <span class="writer-name" onclick="event.stopPropagation(); filterByWriter('${post.writer}')">${post.writer}</span> (${new Date(post.timestamp).toLocaleDateString()})
                </small>
            </div>
        </div>
    `;

    const cardArea = document.getElementById("cardArea");
    cardArea.insertBefore(card, cardArea.firstChild);
}



        function updateFilterButtons() {
            const writers = [...new Set(allPosts.map(post => post.writer))];
            const targets = [...new Set(allPosts.map(post => post.friendName))];
            
            // ÏûëÏÑ±Ïûê ÌïÑÌÑ∞ Î≤ÑÌäº ÏÉùÏÑ±
            const writerFilters = document.getElementById('writerFilters');
            writerFilters.innerHTML = '';
            writers.forEach(writer => {
                const btn = document.createElement('span');
                btn.className = 'filter-btn';
                btn.textContent = writer;
                btn.onclick = () => filterByWriter(writer);
                writerFilters.appendChild(btn);
            });
            
            // ÎåÄÏÉÅÏûê ÌïÑÌÑ∞ Î≤ÑÌäº ÏÉùÏÑ±
            const targetFilters = document.getElementById('targetFilters');
            targetFilters.innerHTML = '';
            targets.forEach(target => {
                const btn = document.createElement('span');
                btn.className = 'filter-btn';
                btn.textContent = target;
                btn.onclick = () => filterByTarget(target);
                targetFilters.appendChild(btn);
            });
        }

        function filterByWriter(writer) {
            currentFilter = { type: 'writer', value: writer };
            applyFilter();
            updateFilterInfo(`‚úçÔ∏è ${writer}ÎãòÏù¥ ÏûëÏÑ±Ìïú Ïπ≠Ï∞¨`);
            updateActiveButton('writer', writer);
        }

        function filterByTarget(target) {
            currentFilter = { type: 'target', value: target };
            applyFilter();
            updateFilterInfo(`üéØ ${target}ÎãòÏù¥ Î∞õÏùÄ Ïπ≠Ï∞¨`);
            updateActiveButton('target', target);
        }

        function filterCards() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (searchTerm === '') {
                clearAllFilters();
                return;
            }
            
            currentFilter = { type: 'search', value: searchTerm };
            applyFilter();
            updateFilterInfo(`üîç "${searchTerm}" Í≤ÄÏÉâ Í≤∞Í≥º`);
            clearActiveButtons();
        }

        function applyFilter() {
            const cards = document.querySelectorAll('.card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                let shouldShow = false;
                
                switch (currentFilter.type) {
                    case 'writer':
                        shouldShow = card.dataset.writer === currentFilter.value;
                        break;
                    case 'target':
                        shouldShow = card.dataset.target === currentFilter.value;
                        break;
                    case 'search':
                        const writer = card.dataset.writer.toLowerCase();
                        const target = card.dataset.target.toLowerCase();
                        shouldShow = writer.includes(currentFilter.value) || target.includes(currentFilter.value);
                        break;
                    case 'all':
                    default:
                        shouldShow = true;
                        break;
                }
                
                if (shouldShow) {
                    card.classList.remove('hidden');
                    visibleCount++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            return visibleCount;
        }

        function clearAllFilters() {
            currentFilter = { type: 'all', value: '' };
            document.getElementById('searchInput').value = '';
            applyFilter();
            updateFilterInfo('Ï†ÑÏ≤¥ Ïπ≠Ï∞¨ Ïπ¥ÎìúÎ•º Î≥¥Í≥† ÏûàÏñ¥Ïöî');
            clearActiveButtons();
            closeSelectedCard(); // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî Ïãú ÏÑ†ÌÉùÎêú Ïπ¥ÎìúÎèÑ Îã´Í∏∞
        }

        function updateFilterInfo(message) {
            const filterInfo = document.getElementById('filterInfo');
            const visibleCount = document.querySelectorAll('.card:not(.hidden)').length;
            filterInfo.textContent = `${message} (${visibleCount}Í∞ú)`;
        }

        function updateActiveButton(type, value) {
            clearActiveButtons();
            const buttons = document.querySelectorAll(`#${type === 'writer' ? 'writerFilters' : 'targetFilters'} .filter-btn`);
            buttons.forEach(btn => {
                if (btn.textContent === value) {
                    btn.classList.add('active');
                }
            });
        }

        function clearActiveButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function resetMyContributions() {
            if (!currentWriter) {
                alert("Î®ºÏ†Ä ÎÇ¥ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî! ‚úèÔ∏è");
                return;
            }

            const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
            
            if (myPostsCount === 0) {
                alert("ÏÇ≠Ï†úÌï† ÎÇ¥ Í∏ÄÏù¥ ÏóÜÏñ¥Ïöî! ü§î");
                return;
            }

            if (confirm(`Ï†ïÎßêÎ°ú ÎÇ¥Í∞Ä Ïì¥ ${myPostsCount}Í∞úÏùò Ïπ≠Ï∞¨ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†Ïñ¥Ïöî? üò¢`)) {
                // ÎÇ¥Í∞Ä Ïì¥ Í∏ÄÎì§Ïùò ID ÏàòÏßë
                const myPostIds = allPosts.filter(post => post.writer === currentWriter).map(post => post.id);
                
                // ÏÑ†ÌÉùÎêú Ïπ¥ÎìúÍ∞Ä ÎÇ¥ Í∏ÄÏù¥Î©¥ Îã´Í∏∞
                if (selectedCardId && myPostIds.includes(selectedCardId)) {
                    closeSelectedCard();
                }
                
                // Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÎÇ¥ Í∏ÄÎì§ Ï†úÍ±∞
                allPosts = allPosts.filter(post => post.writer !== currentWriter);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // ÌôîÎ©¥ÏóêÏÑú ÎÇ¥ ÏûéÏÇ¨Í∑ÄÎì§ Ï†úÍ±∞
                myPostIds.forEach(postId => {
                    const leaf = document.querySelector(`.leaf[data-post-id="${postId}"]`);
                    const card = document.querySelector(`.card[data-post-id="${postId}"]`);
                    
                    if (leaf) leaf.remove();
                    if (card) card.remove();
                });

                updateStats();
                updateResetButton();
                updateFilterButtons();
                clearAllFilters();
                showMessage(`‚úÖ ÎÇ¥Í∞Ä Ïì¥ ${myPostsCount}Í∞úÏùò Í∏ÄÏùÑ ÏÇ≠Ï†úÌñàÏñ¥Ïöî!`);
            }
        }

        function resetAllTree() {
    const totalPosts = allPosts.length;
    
    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    if (currentWriter !== 'ÏµúÎ≥ëÏö∞') {
        alert("Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎäî Í¥ÄÎ¶¨ÏûêÎßå Í∞ÄÎä•Ìï©ÎãàÎã§! üë®‚Äçüíº");
        return;
    }

    if (confirm(`‚ö†Ô∏è Ï£ºÏùò: Î™®Îì† ÏÇ¨ÎûåÏùò Ïπ≠Ï∞¨ ${totalPosts}Í∞úÍ∞Ä Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§!\nÏ†ïÎßêÎ°ú Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎ•º ÌïòÏãúÍ≤†Ïñ¥Ïöî?`)) {
        allPosts = [];
        localStorage.setItem('praisePosts', JSON.stringify(allPosts));
        
        document.getElementById("canopy").innerHTML = "";
        document.getElementById("cardArea").innerHTML = "";
        closeSelectedCard();
        
        updateStats();
        updateResetButton();
        updateFilterButtons();
        clearAllFilters();
        showMessage("üå± Ïπ≠Ï∞¨ ÎÇòÎ¨¥Í∞Ä ÏôÑÏ†ÑÌûà ÏÉàÎ°ú ÏãúÏûëÎêòÏóàÏñ¥Ïöî!");
    }
}


        function updateStats() {
            const totalLeaves = allPosts.length;
            const myLeaves = currentWriter ? allPosts.filter(post => post.writer === currentWriter).length : 0;
            
            document.getElementById('totalLeaves').textContent = totalLeaves;
            document.getElementById('myLeaves').textContent = myLeaves;
        }

        function showMessage(text) {
            const message = document.createElement("div");
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #4caf50;
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                z-index: 1000;
                animation: messageShow 2s ease-in-out forwards;
            `;
            message.textContent = text;
            document.body.appendChild(message);

            setTimeout(() => {
                document.body.removeChild(message);
            }, 2000);
        }

        // Î©îÏãúÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò
        const style = document.createElement('style');
        style.textContent = `
            @keyframes messageShow {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            }
        `;
        document.head.appendChild(style);

        // ÏóîÌÑ∞ÌÇ§ ÏßÄÏõê
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.activeElement.id !== 'writerName') {
                growTree();
            }
        });
    </script>
</body>
</html>
