<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹­ì°¬ ë‚˜ë¬´ (ê°œì¸ë³„ ê´€ë¦¬)</title>
    <style>
        body {
            font-family: "Noto Sans KR", "ë§‘ì€ ê³ ë”•", sans-serif;
            background: #fffde7;
            padding: 20px;
            margin: 0;
        }
        
        h1 {
            color: #f57f17;
            text-align: center;
        }
        
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .left-section {
            flex: 1;
            min-width: 500px;
            text-align: center;
        }
        
        .right-section {
            flex: 1;
            min-width: 400px;
            max-width: 500px;
        }
        
        /* ì„ íƒëœ ì¹´ë“œ í‘œì‹œ ì˜ì—­ */
        .selected-card-display {
            background: linear-gradient(135deg, #fff3e0, #f3e5f5);
            border: 3px solid #ff9800;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            width: 400px;
            min-height: 120px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: selectedCardShow 0.3s ease-out;
            position: relative;
            display: none;
        }
        
        .selected-card-display.show {
            display: block;
        }
        
        .selected-card-display::before {
            content: "ğŸŒŸ ì„ íƒëœ ì¹­ì°¬ ğŸŒŸ";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff9800;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .selected-card-content {
            text-align: center;
        }
        
        .selected-card-content .target-name-large {
            color: #e65100;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .selected-card-content .compliment-large {
            color: #424242;
            font-size: 18px;
            font-style: italic;
            margin: 15px 0;
            line-height: 1.4;
        }
        
        .selected-card-content .writer-large {
            color: #1976d2;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .close-selected {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-selected:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }
        
        @keyframes selectedCardShow {
            0% {
                transform: translateY(-30px) scale(0.9);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .tree {
            position: relative;
            width: 500px;
            height: 700px;
            margin: 20px auto;
            background-image: url('trees.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
        }
        
        .canopy {
            position: absolute;
            top: 250px;
            left: 80px;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            overflow: visible;
        }
        
        .leaf {
            position: absolute;
            font-size: 28px;
            animation: leafGrow 0.5s ease-in-out;
            cursor: pointer;
        }
        
        /* ë‚´ê°€ ì“´ ìì‚¬ê·€ ìŠ¤íƒ€ì¼ */
        .leaf.my-leaf {
            filter: drop-shadow(0 0 3px #4caf50);
        }
        
        @keyframes leafGrow {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .leaf:hover {
            transform: scale(1.2);
            transition: transform 0.2s;
        }
        
        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        .button {
            background-color: #fbc02d;
            color: #333;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
        }
        
        .button:hover {
            background-color: #f9a825;
            transform: translateY(-2px);
            transition: all 0.2s;
        }
        
        .reset-button {
            background-color: #ff7043;
        }
        
        .reset-button:hover {
            background-color: #ff5722;
        }
        
        /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
        }
        
        .button:disabled:hover {
            background-color: #cccccc;
            transform: none;
        }
        
        .card {
            background: #fff9c4;
            border: 2px solid #fdd835;
            border-radius: 10px;
            margin: 10px 0;
            padding: 15px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: cardSlideIn 0.3s ease-out;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* ì„ íƒëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card.selected {
            border-color: #ff9800;
            background: #fff3e0;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .card.selected::after {
            content: "ğŸ‘†";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff9800;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ë‚´ê°€ ì“´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card.my-card {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .card.my-card.selected {
            border-color: #ff9800;
            background: #fff3e0;
        }
        
        .card.my-card::before {
            content: "âœï¸";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 1;
        }
        
        .card.my-card.selected::before {
            display: none;
        }
        
        /* ìˆ¨ê²¨ì§„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card.hidden {
            display: none;
        }
        
        @keyframes cardSlideIn {
            0% {
                transform: translateY(-20px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            display: inline-block;
        }
        
        .user-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            width: 300px;
            display: inline-block;
        }
        
        /* ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ ì•ˆë‚´ ë©”ì‹œì§€ */
        .reset-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* ì˜¤ë¥¸ìª½ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .cards-header {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .filter-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .filter-section h3 {
            margin: 0 0 10px 0;
            color: #f57f17;
        }
        
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        
        .filter-btn {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: #2196f3;
            color: white;
        }
        
        .cards-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .cards-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .cards-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .cards-container::-webkit-scrollbar-thumb {
            background: #fbc02d;
            border-radius: 10px;
        }
        
        .cards-container::-webkit-scrollbar-thumb:hover {
            background: #f9a825;
        }
        
        .search-section {
            margin-bottom: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .clear-filter {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .clear-filter:hover {
            background: #f57c00;
        }
        
        .filter-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .writer-name, .target-name {
            color: #1976d2;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .writer-name:hover, .target-name:hover {
            color: #0d47a1;
            font-weight: bold;
        }
        
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .selected-card-display {
                width: 90%;
                max-width: 400px;
            }
            
            .tree {
                width: 300px;
                height: 450px;
            }
            
            .canopy {
                top: 40px;
                left: 40px;
                width: 220px;
                height: 220px;
            }
            
            .left-section, .right-section {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸŒŸ ìš°ë¦¬ ë°˜ ì¹­ì°¬ ë‚˜ë¬´ ğŸŒŸ</h1>
    <p style="text-align: center;">ì¹œêµ¬ì—ê²Œ ì¹­ì°¬ì„ í•˜ë©´ ë‚˜ë¬´ì— ìì‚¬ê·€(ğŸƒ)ê°€ ìƒê²¨ìš”!</p>
    
    <div class="main-container">
        <!-- ì™¼ìª½ ì„¹ì…˜: ë‚˜ë¬´ì™€ ì»¨íŠ¸ë¡¤ -->
        <div class="left-section">
            <div class="user-info">
                <label for="writerName">âœï¸ ë‚´ ì´ë¦„: </label>
                <input type="text" id="writerName" placeholder="ë‚´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onchange="updateUserInfo()">
                <span id="currentUser"></span>
            </div>
            
            <!-- ì„ íƒëœ ì¹­ì°¬ ì¹´ë“œ í‘œì‹œ ì˜ì—­ -->
            <div class="selected-card-display" id="selectedCardDisplay">
                <button class="close-selected" onclick="closeSelectedCard()">Ã—</button>
                <div class="selected-card-content" id="selectedCardContent">
                    <!-- ì„ íƒëœ ì¹´ë“œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="controls">
                <input type="text" id="friendName" placeholder="ì¹œêµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <input type="text" id="compliment" placeholder="ë”°ëœ»í•œ ì¹­ì°¬ì„ ì ì–´ì£¼ì„¸ìš”">
                <br>
                <button class="button" onclick="growTree()">ğŸŒ± ì¹­ì°¬í•˜ê¸°</button>
                <button class="button reset-button" onclick="resetMyContributions()">ğŸ”„ ë‚´ê°€ ì“´ ê¸€ë§Œ ì‚­ì œ</button>
                <button class="button reset-button" id="resetAllButton" onclick="resetAllTree()" style="background-color: #d32f2f;" disabled>ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
                <div class="reset-info" id="resetInfo">
                    ìì‚¬ê·€ 50ê°œ ì´ìƒì¼ ë•Œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”
                </div>
            </div>

            <div class="stats" id="stats">
                <div>ğŸŒ³ ì „ì²´ ìì‚¬ê·€: <span id="totalLeaves">0</span>ê°œ</div>
                <div>âœï¸ ë‚´ê°€ ì“´ ìì‚¬ê·€: <span id="myLeaves">0</span>ê°œ</div>
            </div>

            <div class="tree">
                <div class="canopy" id="canopy"></div>
            </div>
        </div>
        
        <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜: ì¹­ì°¬ ì¹´ë“œë“¤ -->
        <div class="right-section">
            <div class="cards-header">
                <h2>ğŸ’Œ ì¹­ì°¬ ì¹´ë“œë“¤</h2>
                <p>ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ë‚˜ë¬´ ìœ„ì— í¬ê²Œ í‘œì‹œë¼ìš”!</p>
            </div>
            
            <div class="filter-section">
                <h3>ğŸ” í•„í„°ë§</h3>
                
                <div class="search-section">
                    <input type="text" class="search-input" id="searchInput" placeholder="ì‘ì„±ìë‚˜ ëŒ€ìƒì ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." oninput="filterCards()">
                </div>
                
                <div>
                    <strong>ğŸ‘¥ ì‘ì„±ìë³„:</strong>
                    <div class="filter-buttons" id="writerFilters"></div>
                </div>
                
                <div style="margin-top: 15px;">
                    <strong>ğŸ¯ ëŒ€ìƒìë³„:</strong>
                    <div class="filter-buttons" id="targetFilters"></div>
                </div>
                
                <button class="clear-filter" onclick="clearAllFilters()">ğŸ”„ ì „ì²´ ë³´ê¸°</button>
                
                <div class="filter-info" id="filterInfo">
                    ì „ì²´ ì¹­ì°¬ ì¹´ë“œë¥¼ ë³´ê³  ìˆì–´ìš”
                </div>
            </div>
            
            <div class="cards-container" id="cardArea"></div>
        </div>
    </div>

    <script>
        let currentWriter = '';
        let allPosts = JSON.parse(localStorage.getItem('praisePosts')) || [];
        let currentFilter = { type: 'all', value: '' };
        let selectedCardId = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë³µì›
        window.onload = function() {
            loadSavedData();
            updateStats();
            updateResetButton();
            updateFilterButtons();
        };

        function updateUserInfo() {
            const writerInput = document.getElementById('writerName');
            currentWriter = writerInput.value.trim();
            const currentUserSpan = document.getElementById('currentUser');
            
            if (currentWriter) {
                currentUserSpan.textContent = `(í˜„ì¬: ${currentWriter})`;
                currentUserSpan.style.color = '#4caf50';
                currentUserSpan.style.fontWeight = 'bold';
            } else {
                currentUserSpan.textContent = '';
            }
            updateStats();
        }

function selectCard(postId) {
    // ì´ì „ì— ì„ íƒëœ ì¹´ë“œ ì„ íƒ í•´ì œ
    const previousSelected = document.querySelector('.card.selected');
    if (previousSelected) {
        previousSelected.classList.remove('selected');
    }
    
    // ìƒˆë¡œìš´ ì¹´ë“œ ì„ íƒ (ID ë¹„êµ ì‹œ íƒ€ì… ë³€í™˜ ê³ ë ¤)
    const selectedCard = document.querySelector(`.card[data-post-id="${postId}"]`);
    if (selectedCard) {
        selectedCard.classList.add('selected');
        selectedCardId = postId;
        
        // ì„ íƒëœ ì¹´ë“œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ID ë¹„êµ ì‹œ íƒ€ì… ë³€í™˜ ê³ ë ¤)
        const post = allPosts.find(p => p.id == postId);
        if (post) {
            showSelectedCard(post);
        }
    }
}

function showSelectedCard(post) {
    const display = document.getElementById('selectedCardDisplay');
    const content = document.getElementById('selectedCardContent');
    
    content.innerHTML = `
        <div class="target-name-large">${post.friendName}ë‹˜ì—ê²Œ</div>
        <div class="compliment-large">"${post.compliment}"</div>
        <div class="writer-large">
            ğŸ’ ${post.writer}ë‹˜ì˜ ì¹­ì°¬ 
            <small style="color: #666; font-weight: normal; margin-left: 10px;">
                (${new Date(post.timestamp).toLocaleDateString()})
            </small>
        </div>
    `;
    
    display.classList.add('show');
    
    // ìŠ¤í¬ë¡¤ì„ ì„ íƒëœ ì¹´ë“œ í‘œì‹œ ì˜ì—­ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
    display.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
    });
}

function closeSelectedCard() {
    const display = document.getElementById('selectedCardDisplay');
    display.classList.remove('show');
    
    // ì„ íƒëœ ì¹´ë“œ ì„ íƒ í•´ì œ
    const selectedCard = document.querySelector('.card.selected');
    if (selectedCard) {
        selectedCard.classList.remove('selected');
    }
    
    selectedCardId = null;
}






        function updateResetButton() {
            const resetButton = document.getElementById('resetAllButton');
            const resetInfo = document.getElementById('resetInfo');
            const totalLeaves = allPosts.length;
            
            if (totalLeaves >= 50) {
                resetButton.disabled = false;
                resetButton.style.backgroundColor = '#d32f2f';
                resetInfo.textContent = `ìì‚¬ê·€ê°€ ${totalLeaves}ê°œ! ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”`;
                resetInfo.style.color = '#d32f2f';
            } else {
                resetButton.disabled = true;
                resetButton.style.backgroundColor = '#cccccc';
                resetInfo.textContent = `ìì‚¬ê·€ ${50 - totalLeaves}ê°œ ë” í•„ìš”í•´ìš” (í˜„ì¬ ${totalLeaves}/50)`;
                resetInfo.style.color = '#666';
            }
        }

        function updateResetButton() {
    const resetButton = document.getElementById('resetAllButton');
    const resetInfo = document.getElementById('resetInfo');
    const totalLeaves = allPosts.length;
    
    // ì´ë¦„ì´ 'ìµœë³‘ìš°'ì¸ì§€ í™•ì¸
    const isAuthorized = currentWriter === 'ìµœë³‘ìš°';
    
    if (isAuthorized) {
        resetButton.disabled = false;
        resetButton.style.backgroundColor = '#d32f2f';
        resetInfo.textContent = `ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš” (í˜„ì¬ ${totalLeaves}ê°œ)`;
        resetInfo.style.color = '#d32f2f';
    } else if (currentWriter) {
        resetButton.disabled = true;
        resetButton.style.backgroundColor = '#cccccc';
        resetInfo.textContent = `ì „ì²´ ì´ˆê¸°í™”ëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•´ìš”`;
        resetInfo.style.color = '#666';
    } else {
        resetButton.disabled = true;
        resetButton.style.backgroundColor = '#cccccc';
        resetInfo.textContent = `ì „ì²´ ì´ˆê¸°í™”ëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•´ìš”`;
        resetInfo.style.color = '#666';
    }
}


        function showSelectedCard(post) {
            const display = document.getElementById('selectedCardDisplay');
            const content = document.getElementById('selectedCardContent');
            
            content.innerHTML = `
                <div class="target-name-large">${post.friendName}ë‹˜ì—ê²Œ</div>
                <div class="compliment-large">"${post.compliment}"</div>
                <div class="writer-large">
                    ğŸ’ ${post.writer}ë‹˜ì˜ ì¹­ì°¬ 
                    <small style="color: #666; font-weight: normal; margin-left: 10px;">
                        (${new Date(post.timestamp).toLocaleDateString()})
                    </small>
                </div>
            `;
            
            display.classList.add('show');
            
            // ìŠ¤í¬ë¡¤ì„ ì„ íƒëœ ì¹´ë“œ í‘œì‹œ ì˜ì—­ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
            display.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }

        function closeSelectedCard() {
            const display = document.getElementById('selectedCardDisplay');
            display.classList.remove('show');
            
            // ì„ íƒëœ ì¹´ë“œ ì„ íƒ í•´ì œ
            const selectedCard = document.querySelector('.card.selected');
            if (selectedCard) {
                selectedCard.classList.remove('selected');
            }
            
            selectedCardId = null;
        }

        function growTree() {
            const friendName = document.getElementById("friendName").value.trim();
            const compliment = document.getElementById("compliment").value.trim();
            
            if (!currentWriter) {
                alert("ë¨¼ì € ë‚´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! âœï¸");
                document.getElementById('writerName').focus();
                return;
            }

            if (friendName && compliment) {
                const postId = Date.now() + Math.random(); // ê³ ìœ  ID ìƒì„±
                const newPost = {
                    id: postId,
                    writer: currentWriter,
                    friendName: friendName,
                    compliment: compliment,
                    timestamp: new Date().toISOString()
                };

                // ë°ì´í„° ì €ì¥
                allPosts.push(newPost);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // ìì‚¬ê·€ ìƒì„±
                createLeaf(newPost);
                
                // ì¹´ë“œ ìƒì„±
                createCard(newPost);

                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                document.getElementById("friendName").value = "";
                document.getElementById("compliment").value = "";

                // í†µê³„ ë° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateStats();
                updateResetButton();
                updateFilterButtons();

                // ì„±ì·¨ê° ë©”ì‹œì§€
                const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
                const totalPosts = allPosts.length;
                
                if (myPostsCount === 1) {
                    showMessage("ğŸ‰ ì²« ë²ˆì§¸ ì¹­ì°¬ì„ ë‚¨ê²¼ì–´ìš”!");
                } else if (myPostsCount % 5 === 0) {
                    showMessage(`ğŸŒŸ ${myPostsCount}ë²ˆì§¸ ì¹­ì°¬ì´ì—ìš”! ë©‹ì ¸ìš”!`);
                }
                
                // 50ê°œ ë‹¬ì„± ì‹œ íŠ¹ë³„ ë©”ì‹œì§€
                if (totalPosts === 50) {
                    showMessage("ğŸŠ ì¶•í•˜í•´ìš”! ìì‚¬ê·€ 50ê°œ ë‹¬ì„±! ì´ì œ ì „ì²´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•´ìš”!");
                }

            } else {
                alert("ì¹œêµ¬ ì´ë¦„ê³¼ ì¹­ì°¬ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”! ğŸ’");
            }
        }

        function createLeaf(post) {
            const canopy = document.getElementById("canopy");
            const leaf = document.createElement("div");
            leaf.classList.add("leaf");
            leaf.innerHTML = "ğŸƒ";
            leaf.title = `${post.writer} â†’ ${post.friendName}: ${post.compliment}`;
            leaf.dataset.postId = post.id;
            
            // ë‚´ê°€ ì“´ ê¸€ì¸ì§€ í™•ì¸
            if (post.writer === currentWriter) {
                leaf.classList.add("my-leaf");
            }

            // ëœë¤ ìœ„ì¹˜ ë°°ì¹˜
            const maxX = canopy.clientWidth - 40;
            const maxY = canopy.clientHeight - 40;
            leaf.style.left = Math.random() * maxX + "px";
            leaf.style.top = Math.random() * maxY + "px";

            canopy.appendChild(leaf);
        }

       function createCard(post) {
    const card = document.createElement("div");
    card.classList.add("card");
    card.dataset.postId = post.id;
    card.dataset.writer = post.writer;
    card.dataset.target = post.friendName;
    
    // ë‚´ê°€ ì“´ ê¸€ì¸ì§€ í™•ì¸
    if (post.writer === currentWriter) {
        card.classList.add("my-card");
    }

    // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    card.onclick = (event) => {
        // ì´ë²¤íŠ¸ê°€ ì‘ì„±ìë‚˜ ëŒ€ìƒì ì´ë¦„ì—ì„œ ë°œìƒí•œ ê²½ìš° ì¹´ë“œ ì„ íƒì„ ë§‰ìŒ
        if (event.target.classList.contains('writer-name') || event.target.classList.contains('target-name')) {
            return;
        }
        selectCard(post.id);
    };

    card.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 24px; margin-right: 10px;">ğŸ’Œ</span>
            <div>
                <strong style="color: #f57f17; font-size: 18px;" class="target-name" onclick="event.stopPropagation(); filterByTarget('${post.friendName}')">${post.friendName}</strong>ì—ê²Œ<br>
                <em style="color: #555;">"${post.compliment}"</em><br>
                <small style="color: #888; margin-top: 5px; display: block;">
                    - <span class="writer-name" onclick="event.stopPropagation(); filterByWriter('${post.writer}')">${post.writer}</span> (${new Date(post.timestamp).toLocaleDateString()})
                </small>
            </div>
        </div>
    `;

    const cardArea = document.getElementById("cardArea");
    cardArea.insertBefore(card, cardArea.firstChild);
}



        function updateFilterButtons() {
            const writers = [...new Set(allPosts.map(post => post.writer))];
            const targets = [...new Set(allPosts.map(post => post.friendName))];
            
            // ì‘ì„±ì í•„í„° ë²„íŠ¼ ìƒì„±
            const writerFilters = document.getElementById('writerFilters');
            writerFilters.innerHTML = '';
            writers.forEach(writer => {
                const btn = document.createElement('span');
                btn.className = 'filter-btn';
                btn.textContent = writer;
                btn.onclick = () => filterByWriter(writer);
                writerFilters.appendChild(btn);
            });
            
            // ëŒ€ìƒì í•„í„° ë²„íŠ¼ ìƒì„±
            const targetFilters = document.getElementById('targetFilters');
            targetFilters.innerHTML = '';
            targets.forEach(target => {
                const btn = document.createElement('span');
                btn.className = 'filter-btn';
                btn.textContent = target;
                btn.onclick = () => filterByTarget(target);
                targetFilters.appendChild(btn);
            });
        }

        function filterByWriter(writer) {
            currentFilter = { type: 'writer', value: writer };
            applyFilter();
            updateFilterInfo(`âœï¸ ${writer}ë‹˜ì´ ì‘ì„±í•œ ì¹­ì°¬`);
            updateActiveButton('writer', writer);
        }

        function filterByTarget(target) {
            currentFilter = { type: 'target', value: target };
            applyFilter();
            updateFilterInfo(`ğŸ¯ ${target}ë‹˜ì´ ë°›ì€ ì¹­ì°¬`);
            updateActiveButton('target', target);
        }

        function filterCards() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (searchTerm === '') {
                clearAllFilters();
                return;
            }
            
            currentFilter = { type: 'search', value: searchTerm };
            applyFilter();
            updateFilterInfo(`ğŸ” "${searchTerm}" ê²€ìƒ‰ ê²°ê³¼`);
            clearActiveButtons();
        }

        function applyFilter() {
            const cards = document.querySelectorAll('.card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                let shouldShow = false;
                
                switch (currentFilter.type) {
                    case 'writer':
                        shouldShow = card.dataset.writer === currentFilter.value;
                        break;
                    case 'target':
                        shouldShow = card.dataset.target === currentFilter.value;
                        break;
                    case 'search':
                        const writer = card.dataset.writer.toLowerCase();
                        const target = card.dataset.target.toLowerCase();
                        shouldShow = writer.includes(currentFilter.value) || target.includes(currentFilter.value);
                        break;
                    case 'all':
                    default:
                        shouldShow = true;
                        break;
                }
                
                if (shouldShow) {
                    card.classList.remove('hidden');
                    visibleCount++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            return visibleCount;
        }

        function clearAllFilters() {
            currentFilter = { type: 'all', value: '' };
            document.getElementById('searchInput').value = '';
            applyFilter();
            updateFilterInfo('ì „ì²´ ì¹­ì°¬ ì¹´ë“œë¥¼ ë³´ê³  ìˆì–´ìš”');
            clearActiveButtons();
            closeSelectedCard(); // í•„í„° ì´ˆê¸°í™” ì‹œ ì„ íƒëœ ì¹´ë“œë„ ë‹«ê¸°
        }

        function updateFilterInfo(message) {
            const filterInfo = document.getElementById('filterInfo');
            const visibleCount = document.querySelectorAll('.card:not(.hidden)').length;
            filterInfo.textContent = `${message} (${visibleCount}ê°œ)`;
        }

        function updateActiveButton(type, value) {
            clearActiveButtons();
            const buttons = document.querySelectorAll(`#${type === 'writer' ? 'writerFilters' : 'targetFilters'} .filter-btn`);
            buttons.forEach(btn => {
                if (btn.textContent === value) {
                    btn.classList.add('active');
                }
            });
        }

        function clearActiveButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function resetMyContributions() {
            if (!currentWriter) {
                alert("ë¨¼ì € ë‚´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! âœï¸");
                return;
            }

            const myPostsCount = allPosts.filter(post => post.writer === currentWriter).length;
            
            if (myPostsCount === 0) {
                alert("ì‚­ì œí•  ë‚´ ê¸€ì´ ì—†ì–´ìš”! ğŸ¤”");
                return;
            }

            if (confirm(`ì •ë§ë¡œ ë‚´ê°€ ì“´ ${myPostsCount}ê°œì˜ ì¹­ì°¬ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”? ğŸ˜¢`)) {
                // ë‚´ê°€ ì“´ ê¸€ë“¤ì˜ ID ìˆ˜ì§‘
                const myPostIds = allPosts.filter(post => post.writer === currentWriter).map(post => post.id);
                
                // ì„ íƒëœ ì¹´ë“œê°€ ë‚´ ê¸€ì´ë©´ ë‹«ê¸°
                if (selectedCardId && myPostIds.includes(selectedCardId)) {
                    closeSelectedCard();
                }
                
                // ë°ì´í„°ì—ì„œ ë‚´ ê¸€ë“¤ ì œê±°
                allPosts = allPosts.filter(post => post.writer !== currentWriter);
                localStorage.setItem('praisePosts', JSON.stringify(allPosts));

                // í™”ë©´ì—ì„œ ë‚´ ìì‚¬ê·€ë“¤ ì œê±°
                myPostIds.forEach(postId => {
                    const leaf = document.querySelector(`.leaf[data-post-id="${postId}"]`);
                    const card = document.querySelector(`.card[data-post-id="${postId}"]`);
                    
                    if (leaf) leaf.remove();
                    if (card) card.remove();
                });

                updateStats();
                updateResetButton();
                updateFilterButtons();
                clearAllFilters();
                showMessage(`âœ… ë‚´ê°€ ì“´ ${myPostsCount}ê°œì˜ ê¸€ì„ ì‚­ì œí–ˆì–´ìš”!`);
            }
        }

        function resetAllTree() {
    const totalPosts = allPosts.length;
    
    // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
    if (currentWriter !== 'ìµœë³‘ìš°') {
        alert("ì „ì²´ ì´ˆê¸°í™”ëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤! ğŸ‘¨â€ğŸ’¼");
        return;
    }

    if (confirm(`âš ï¸ ì£¼ì˜: ëª¨ë“  ì‚¬ëŒì˜ ì¹­ì°¬ ${totalPosts}ê°œê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤!\nì •ë§ë¡œ ì „ì²´ ì´ˆê¸°í™”ë¥¼ í•˜ì‹œê² ì–´ìš”?`)) {
        allPosts = [];
        localStorage.setItem('praisePosts', JSON.stringify(allPosts));
        
        document.getElementById("canopy").innerHTML = "";
        document.getElementById("cardArea").innerHTML = "";
        closeSelectedCard();
        
        updateStats();
        updateResetButton();
        updateFilterButtons();
        clearAllFilters();
        showMessage("ğŸŒ± ì¹­ì°¬ ë‚˜ë¬´ê°€ ì™„ì „íˆ ìƒˆë¡œ ì‹œì‘ë˜ì—ˆì–´ìš”!");
    }
}


        function updateStats() {
            const totalLeaves = allPosts.length;
            const myLeaves = currentWriter ? allPosts.filter(post => post.writer === currentWriter).length : 0;
            
            document.getElementById('totalLeaves').textContent = totalLeaves;
            document.getElementById('myLeaves').textContent = myLeaves;
        }

        function showMessage(text) {
            const message = document.createElement("div");
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #4caf50;
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                z-index: 1000;
                animation: messageShow 2s ease-in-out forwards;
            `;
            message.textContent = text;
            document.body.appendChild(message);

            setTimeout(() => {
                document.body.removeChild(message);
            }, 2000);
        }

        // ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜
        const style = document.createElement('style');
        style.textContent = `
            @keyframes messageShow {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            }
        `;
        document.head.appendChild(style);

        // ì—”í„°í‚¤ ì§€ì›
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.activeElement.id !== 'writerName') {
                growTree();
            }
        });
    </script>
</body>
</html>
